npm install

npm run test

if [ $? != 0 ]
then echo TESTS HAVE FAILED; exit $?
fi


rm -r node_modules
rm package-lock.json

npm install -prod

docker run --rm \
--volume ${PWD}:/workspace --env METERIAN_API_TOKEN=$METERIAN_API_TOKEN \
meterian-cli --project-url=pagesify --project-commit=$GIT_COMMIT --project-branch=$GIT_BRANCH


if [ $? != 0 ]
then echo METERIAN SCAN HAS FAILED; exit $?
fi 

mkdir -p pagesify-build
cp -r * ./pagesify-build
cd pagesify-build 

rm -r pagesify-build resources build __tests__ README.md

cd ..
mkdir -p bin
tar -czvf ./bin/pagesify-build.tar.gz ./pagesify-build/*